<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Squid::Tasks: Task Manager</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Squid::Tasks<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">C++14 coroutine-based task library for games</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('group___task_manager.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a>  </div>
  <div class="headertitle"><div class="title">Task Manager</div></div>
</div><!--header-->
<div class="contents">

<p>Manager that runs and resumes a collection of tasks.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_task_manager.html">TaskManager</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Manager that runs and resumes a collection of tasks.  <a href="class_task_manager.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p >Manager that runs and resumes a collection of tasks. </p>
<p >A <a class="el" href="class_task_manager.html" title="Manager that runs and resumes a collection of tasks.">TaskManager</a> is a simple manager class that holds an ordered list of tasks and resumes them whenever it is updated.</p>
<h2><a class="anchor" id="autotoc_md6"></a>
Running Tasks</h2>
<p >There are two primary ways to run tasks on a task manager.</p>
<p >The first method (running an "unmanaged task") is to pass a task into <a class="el" href="class_task_manager.html#a8c830099f66a70cf1e9738f38cfa7b92">TaskManager::Run()</a>. This will move the task into the task manager and return a <a class="el" href="group___tasks.html#ga1f2b9fd911039e54ab85363cf0ff18bf">TaskHandle</a> that can be used to observe and manage the lifetime of the task (as well as potentially take a return value after the task finishes). With unmanaged tasks, the task manager only holds a weak reference to the task, meaning that the <a class="el" href="group___tasks.html#ga1f2b9fd911039e54ab85363cf0ff18bf">TaskHandle</a> returned by <a class="el" href="class_task_manager.html#a8c830099f66a70cf1e9738f38cfa7b92">TaskManager::Run()</a> is the only remaining strong reference to the task. Because of this, the caller is entirely responsible for managing the lifetime of the task.</p>
<p >The second method (running a "managed task") is to pass a task into <a class="el" href="class_task_manager.html#a6d4067e7844a11e461b4895b5d7cd06f">TaskManager::RunManaged()</a>. Like <a class="el" href="class_task_manager.html#a8c830099f66a70cf1e9738f38cfa7b92">TaskManager::Run()</a>, this will move the task into the task manager and return a <a class="el" href="group___tasks.html#ga353ea2f1c080c356fbb61dc4f078475a">WeakTaskHandle</a> that can be used to observe the lifetime of the task (as well as manually kill it, if desired). Unlike unmanaged tasks, the task manager stores a strong reference to the task. Because of this, that caller is not responsible for managing the lifetime of the task. This difference in task ownership means that (unlike an unmanaged task) a managed task can be thought of as a "fire-and-forget" task that will run until either it finishes or until something else explicitly kills it.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
Order of Execution</h2>
<p >The ordering of task updates within a call to <a class="el" href="class_task_manager.html#ac1f7b0e56478c6cad6e79ebf1d35648b">TaskManager::Update()</a> is stable, meaning that the first task that is run on a task manager will remain the first to resume, no matter how many other tasks are run on the task manager (or terminate) in the meantime.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
Integration into Actor Classes</h2>
<p >Consider the following example of a <a class="el" href="class_task_manager.html" title="Manager that runs and resumes a collection of tasks.">TaskManager</a> that has been integrated into a TaskActor base class:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>TaskActor : <span class="keyword">public</span> Actor</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> OnInitialize() override <span class="comment">// Automatically called when this enemy enters the scene</span></div>
<div class="line">    {</div>
<div class="line">        Actor::OnInitialize(); <span class="comment">// Call the base Actor function</span></div>
<div class="line">        m_taskMgr.RunManaged(ManageActor()); <span class="comment">// Run main actor task as a fire-and-forget &quot;managed task&quot;</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> Tick(<span class="keywordtype">float</span> in_dt) <span class="keyword">override</span> <span class="comment">// Automatically called every frame</span></div>
<div class="line">    {</div>
<div class="line">        Actor::Tick(in_dt); <span class="comment">// Call the base Actor function</span></div>
<div class="line">        m_taskMgr.Update(); <span class="comment">// Resume all active tasks once per tick</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> OnDestroy() override <span class="comment">// Automatically called when this enemy leaves the scene</span></div>
<div class="line">    {</div>
<div class="line">        m_taskMgr.KillAllTasks(); <span class="comment">// Kill all active tasks when we leave the scene</span></div>
<div class="line">        Actor::OnDestroy(); <span class="comment">// Call the base Actor function</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">    <span class="keyword">virtual</span> <a class="code hl_class" href="class_task.html">Task&lt;&gt;</a> ManageActor() <span class="comment">// Overridden (in its entirety) by child classes</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">co_await</span> <a class="code hl_function" href="group___awaiters.html#ga8bd20c24d2cd11c6edb6a392934514c9">WaitForever</a>(); <span class="comment">// Waits forever (doing nothing)</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="class_task_manager.html">TaskManager</a> m_taskMgr;</div>
<div class="line">};</div>
<div class="ttc" id="aclass_task_html"><div class="ttname"><a href="class_task.html">Task</a></div><div class="ttdef"><b>Definition:</b> Task.h:204</div></div>
<div class="ttc" id="aclass_task_manager_html"><div class="ttname"><a href="class_task_manager.html">TaskManager</a></div><div class="ttdoc">Manager that runs and resumes a collection of tasks.</div><div class="ttdef"><b>Definition:</b> TaskManager.h:88</div></div>
<div class="ttc" id="agroup___awaiters_html_ga8bd20c24d2cd11c6edb6a392934514c9"><div class="ttname"><a href="group___awaiters.html#ga8bd20c24d2cd11c6edb6a392934514c9">WaitForever</a></div><div class="ttdeci">Task WaitForever()</div><div class="ttdoc">Awaiter function that waits forever (only for use in tasks that will be killed externally)</div><div class="ttdef"><b>Definition:</b> Task.h:843</div></div>
</div><!-- fragment --><p >In the above example, <a class="el" href="class_task_manager.html" title="Manager that runs and resumes a collection of tasks.">TaskManager</a> is instantiated once per high-level actor. It is updated once per frame within the Tick() method, and all its tasks are killed when it leaves the scene in OnDestroy(). Lastly, a single entry-point coroutine is run as a managed task when the actor enters the scene. (The above is the conventional method of integration into this style of game engine.)</p>
<p >Note that it is sometimes necessary to have multiple TaskManagers within a single actor. For example, if there are multiple tick functions (such as one for pre-physics updates and one for post-physics updates), then instantiating a second "post-physics" task manager may be desirable. </p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
