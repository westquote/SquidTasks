<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Squid::Tasks: Function Guard</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Squid::Tasks<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">C++14 coroutine-based task library for games</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('group___function_guard.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">Function Guard</div></div>
</div><!--header-->
<div class="contents">

<p>Scope guard that calls a function as it leaves scope.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_function_guard.html">FunctionGuard&lt; tFn &gt;</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga6f27736a6256436bd33cbd0a3741adf2"><td class="memTemplParams" colspan="2"><a id="ga6f27736a6256436bd33cbd0a3741adf2" name="ga6f27736a6256436bd33cbd0a3741adf2"></a>
template&lt;typename tFn &gt; </td></tr>
<tr class="memitem:ga6f27736a6256436bd33cbd0a3741adf2"><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="class_function_guard.html">FunctionGuard</a>&lt; tFn &gt;&#160;</td><td class="memTemplItemRight" valign="bottom"><b>MakeFnGuard</b> (tFn in_fn)</td></tr>
<tr class="memdesc:ga6f27736a6256436bd33cbd0a3741adf2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a function guard (directly stores the concretely-typed functor in the <a class="el" href="class_function_guard.html">FunctionGuard</a>) <br /></td></tr>
<tr class="separator:ga6f27736a6256436bd33cbd0a3741adf2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4e276085c169f5c7d057c3444b1770fa"><td class="memItemLeft" align="right" valign="top"><a id="ga4e276085c169f5c7d057c3444b1770fa" name="ga4e276085c169f5c7d057c3444b1770fa"></a>
<a class="el" href="class_function_guard.html">FunctionGuard</a>&#160;</td><td class="memItemRight" valign="bottom"><b>MakeGenericFnGuard</b> (std::function&lt; void()&gt; in_fn)</td></tr>
<tr class="memdesc:ga4e276085c169f5c7d057c3444b1770fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a generic function guard (preferable when re-assigning new functor values to the same variable) <br /></td></tr>
<tr class="separator:ga4e276085c169f5c7d057c3444b1770fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p >Scope guard that calls a function as it leaves scope. </p>
<p >A <a class="el" href="class_function_guard.html">FunctionGuard</a> is an scope guard object that stores a functor that will be called from its destructor. By convention, scope guards are move-only objects that are intended for allocation on the stack, to ensure that certain operations are performed exactly once (when their scope collapses).</p>
<p >Because tasks can be canceled while suspended (and thus do not reach the end of the function), any cleanup code at the end of a task isn't guaranteed to execute. Because <a class="el" href="class_function_guard.html">FunctionGuard</a> is an RAII object, it gives programmers an opportunity to schedule guaranteed cleanup code, no matter how a task terminates.</p>
<p >Consider the following example of a task that manages a character's "charge attack" in a combat-oriented game:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>Character : <span class="keyword">public</span> Actor</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <a class="code hl_class" href="class_task.html">Task&lt;&gt;</a> ChargeAttackState()</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">bool</span> bIsFullyCharged = <span class="keyword">false</span>;</div>
<div class="line">        <span class="keywordflow">if</span>(Input-&gt;IsAttackButtonPressed())</div>
<div class="line">        {</div>
<div class="line">            StartCharging(); <span class="comment">// Start playing charge effects</span></div>
<div class="line">            <span class="keyword">auto</span> stopChargingGuard = <a class="code hl_function" href="group___function_guard.html#ga6f27736a6256436bd33cbd0a3741adf2">MakeFnGuard</a>([&amp;]{</div>
<div class="line">                StopCharging(); <span class="comment">// Stop playing charge effects</span></div>
<div class="line">            });</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Wait for N seconds (canceling if button is no longer held)</span></div>
<div class="line">            bIsFullyCharged = <span class="keyword">co_await</span> <a class="code hl_function" href="group___awaiters.html#gad09d1c3766b54864b929aef77424e392">WaitSeconds</a>(chargeTime).CancelIf([&amp;] {</div>
<div class="line">                <span class="keywordflow">return</span> !Input-&gt;IsAttackButtonPressed();</div>
<div class="line">            });</div>
<div class="line">        } <span class="comment">// &lt;-- This is when StopCharging() will be called</span></div>
<div class="line">        FireShot(bIsFullyCharged);</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="ttc" id="aclass_task_html"><div class="ttname"><a href="class_task.html">Task</a></div><div class="ttdef"><b>Definition:</b> Task.h:204</div></div>
<div class="ttc" id="agroup___awaiters_html_gad09d1c3766b54864b929aef77424e392"><div class="ttname"><a href="group___awaiters.html#gad09d1c3766b54864b929aef77424e392">WaitSeconds</a></div><div class="ttdeci">Task&lt; tTaskTime &gt; WaitSeconds(tTaskTime in_seconds, tTimeFn in_timeFn)</div><div class="ttdoc">Awaiter function that waits N seconds in a given time-stream.</div><div class="ttdef"><b>Definition:</b> Task.h:850</div></div>
<div class="ttc" id="agroup___function_guard_html_ga6f27736a6256436bd33cbd0a3741adf2"><div class="ttname"><a href="group___function_guard.html#ga6f27736a6256436bd33cbd0a3741adf2">MakeFnGuard</a></div><div class="ttdeci">FunctionGuard&lt; tFn &gt; MakeFnGuard(tFn in_fn)</div><div class="ttdoc">Create a function guard (directly stores the concretely-typed functor in the FunctionGuard)</div><div class="ttdef"><b>Definition:</b> FunctionGuard.h:115</div></div>
</div><!-- fragment --><p >In the above example, we can guarantee that StopCharging will logically be called exactly once for every call to StartCharging(), even the ChargeAttackState() task is killed or canceled. Furthermore, we know that StopCharging() will always be called prior to the call to FireShot().</p>
<p >In practice, it is often desirable to create more domain-specific scope guards for specific use cases, but <a class="el" href="class_function_guard.html">FunctionGuard</a> provides a simple general-purpose tool for writing robust, water-tight coroutine logic without the overhead of creating bespoke support classes. </p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
